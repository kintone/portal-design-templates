{"name":"classic-days2020","html":"<div class=\"designportal\">\n  <div class=\"warning-wrapper\"></div>\n  <div class=\"design-portal-container\">\n    <div class=\"designportal-left\"></div>\n    <div class=\"designportal-right\"></div>\n  </div>\n</div>\n\n<script id=\"sectionTemplate\" type=\"text/x-jsrender\">\n  <section class=\"classic-contents_wrap\">\n    <div class=\"classic-contents_header\">\n      <img class=\"classic-list_section\" alt=\"\" width=\"56\" height=\"56\"\n        {{if section.sectionIconFileKey}}data-fileKey={{>section.sectionIconFileKey}}{{/if}} />\n      <h3 class=\"classic-contents_title\">{{>section.sectionHeading.value}}</h3>\n    </div>\n    <ul class=\"classic-list\">\n    {{for links}}\n      <li class=\"classic-list_item\">\n        <div>\n          <img class=\"classic-list_icon\" alt=\"\" width=\"32\" height=\"32\"\n           {{if linkIconFileKey}}data-fileKey={{>linkIconFileKey}}{{/if}} />\n        </div>\n        <div class=\"classic-list_name\"><a href={{>linkUrl.value}}>{{>linkTitle.value}}</a></div>\n      </li>\n    {{/for}}\n    </ul>\n  </section>\n</script>\n\n<script id=\"warningTemplate-jp\" type=\"text/x-jsrender\">\n  <section class=\"warning\">\n    <h3 class=\"warning-heading\">このテンプレートを使うには専用アプリのインストールが必要です</h3>\n    <div><a href=\"https://developer.cybozu.io/hc/ja/articles/900003334846\" target=\"_blank\">「classic-appポータル」テンプレートのセットアップ手順を参照してください。</a></div>\n    <div class=\"warning-features\">\n    このテンプレートを使うと、ポータルに掲載するリンクをアプリで管理できます。</div>\n      <div class=\"warning-images\">\n        <img src=\"https://github.com/kintone/portal-design-templates/raw/master/classic/screenshots/classic_screenshot_01.png\" alt=\"\">\n        <img src=\"https://github.com/kintone/portal-design-templates/raw/master/classic/screenshots/classic_screenshot_02.png\" alt=\"\">\n      </div>\n    </div>\n  </section>\n</script>\n\n<script id=\"warningTemplate-en\" type=\"text/x-jsrender\">\n  <section class=\"warning\">\n    <h3 class=\"warning-heading\">You need to install a dedicated app to use this template.</h3>\n  </section>\n</script>","css":".designportal .warning-wrapper {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.designportal .warning {\n  margin: 1em auto;\n  padding: 1em;\n  background: #fff;\n  text-align: center;\n}\n\n.designportal .warning-heading {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin: 0;\n}\n\n.designportal .warning-features {\n  margin-top: 1em;\n  padding-top: 1em;\n  border-top: 1px solid #333;\n}\n\n.designportal .warning-images {\n  display: flex;\n  justify-content: center;\n}\n\n.designportal .warning-images img {\n  width: 40%;\n  margin: 1em;\n}\n\n.designportal .design-portal-container {\n  display: flex;\n}\n\n@media screen and (max-width: 768px) {\n  .designportal .design-portal-container {\n    flex-direction: column;\n  }\n}\n\n.designportal .designportal-left {\n  flex: 1;\n}\n\n.designportal .designportal-right {\n  flex: 1;\n}\n\n.designportal .classic-contents_wrap {\n  box-sizing: border-box;\n  margin: 1em;\n  background-color: #fff;\n  letter-spacing: 0.04em;\n}\n\n.designportal .classic-contents_header {\n  border-bottom: 1px solid #e3e7e8;\n  display: flex;\n  align-items: center;\n  margin: 0;\n  font-weight: 400;\n}\n\n.designportal .classic-contents_title {\n  display: inline-block;\n  margin-left: 1.25em;\n  margin-top: 0.5em;\n  margin-bottom: 0.5em;\n  font-size: 1.25em;\n  font-weight: normal;\n}\n\n.designportal .classic-list {\n  list-style-type: none;\n  margin: 0;\n  padding: 0;\n  font-size: 1em;\n}\n\n.designportal .classic-list_item {\n  position: relative;\n  word-wrap: normal;\n  height: 3.5em;\n  padding: 0 1em;\n  display: flex;\n  align-items: center;\n}\n\n.designportal .classic-list_name {\n  flex: 1;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.designportal .classic-list_name a {\n  display: block;\n  flex: 1;\n  color: #333;\n}\n\n.designportal .classic-list_name:hover,\n.designportal .classic-list_name:focus-within {\n  text-decoration: underline;\n}\n\n.designportal .classic-list_item:nth-of-type(2n+1) {\n  background-color: #fff;\n}\n\n.designportal .classic-list_item:nth-of-type(2n) {\n  background-color: #f2f4f6;\n}\n\n.designportal .classic-list_icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  align-items: center;\n  width: 2.5em;\n  height: 2.5em;\n  fill: #fff;\n}\n\n.designportal .classic-list_name {\n  padding-left: 0.5em;\n}\n","js":"(function () {\n  /**\n   * アプリIDをここに入力します\n   */\n  const CONFIG_APP_ID = \"\";\n\n  /** \n   * レコードIDをここに入力します\n   */\n  const CONFIG_RECORD_ID = \"\";\n\n  const JS_RENDER_URL = \"https://js.cybozu.com/jsrender/1.0.7/jsrender.min.js\";\n  const DEFAULT_SECTION_URL = \"https://static.cybozu.com/contents/k/image/argo/uiparts/widget/apps_56.png\";\n  const DEFAULT_LINK_URL = \"https://static.cybozu.com/contents/k/image/icon/app/appTableBlue.png\";\n\n  const loadScript = function (src) {\n    return new Promise(function (resolve) {\n      const scriptEl = document.createElement(\"script\");\n      scriptEl.src = src;\n      document.body.appendChild(scriptEl);\n      scriptEl.onload = resolve;\n    });\n  }\n\n  const assertConfig = function () {\n    if (!CONFIG_APP_ID || !CONFIG_RECORD_ID) {\n      const containerEl = document.querySelector(\".warning-wrapper\");\n      if (kintone.getLoginUser().language === \"ja\") {\n        renderTemplate(containerEl, \"warningTemplate-jp\", null);\n      } else {\n        renderTemplate(containerEl, \"warningTemplate-en\", null);\n      }\n      throw Error(\"invalid CONFIG_APP_ID or CONFIG_RECORD_ID\");\n    }\n  };\n\n  const assertJsRender = function () {\n    if (!window.jsrender) {\n      throw Error(\"JsRender cannot be loaded.\");\n    }\n  };\n\n  const htmlStringToElement = function (htmlString) {\n    const temp = document.createElement(\"div\");\n    temp.innerHTML = htmlString;\n    return temp.firstElementChild;\n  };\n\n  const getTemplateById = function (templateId) {\n    assertJsRender();\n    const $ = window.jsrender;\n    const markup = document.getElementById(templateId).innerHTML;\n    return $.templates(markup);\n  };\n\n  const generateElementFromTemplate = function (templateId, model) {\n    const htmlString = getTemplateById(templateId).render(model);\n    return htmlStringToElement(htmlString);\n  };\n\n  const renderTemplate = function (containerEl, templateId, templateModel) {\n    const element = generateElementFromTemplate(templateId, templateModel);\n    containerEl.appendChild(element);\n    return element;\n  };\n\n  //----------------------------------------------------------------------------\n  // fetch\n\n  const fetchKintoneRecord = function (appId, recordId) {\n    return kintone.api(kintone.api.url(\"/k/v1/record\", true), \"GET\", { app: appId, id: recordId });\n  };\n\n  const fetchConfig = function (configAppId, configRecordId) {\n    return fetchKintoneRecord(CONFIG_APP_ID, CONFIG_RECORD_ID);\n  };\n\n  //----------------------------------------------------------------------------\n  // model\n\n  const filterByPosition = function (json, position) {\n    return json.record.sections.value.filter(function (jsonSection) {\n      return jsonSection.value.position.value === position;\n    });\n  };\n\n  const addSectionIconFileKey = function (jsonSection) {\n    const section = jsonSection.value;\n    const sectionIconUrl = jsonSection.value.sectionIcon.value;\n    section.sectionIconFileKey = sectionIconUrl.length !== 0 ? sectionIconUrl[0].fileKey : \"\";\n    return section;\n  };\n\n  const addLinkIconFileKey = function (jsonLink) {\n    const link = jsonLink.value;\n    const linkIconUrl = jsonLink.value.linkIconUrl.value;\n    link.linkIconFileKey = linkIconUrl.length !== 0 ? linkIconUrl[0].fileKey : \"\";\n    return link;\n  };\n\n  const convertToLinkModels = function (jsonLinks, sectionId) {\n    const filterBySectionId = function (jsonLink) {\n      return jsonLink.value.sectionIdRef.value === sectionId;\n    }\n    return jsonLinks.filter(filterBySectionId).map(addLinkIconFileKey);\n  };\n\n  const convertToModelList = function (jsonSections, jsonLinks) {\n    return jsonSections.map(function (jsonSection) {\n      const sectionId = jsonSection.value.sectionId.value;\n      const section = addSectionIconFileKey(jsonSection);\n      const links = convertToLinkModels(jsonLinks, sectionId);\n      return { section: section, links: links };\n    });\n  };\n\n  const convertToModel = function (json) {\n    const jsonLeftSection = filterByPosition(json, \"left\");\n    const jsonRightSection = filterByPosition(json, \"right\");\n    const jsonLinks = json.record.links.value;\n    return {\n      \"left\": convertToModelList(jsonLeftSection, jsonLinks),\n      \"right\": convertToModelList(jsonRightSection, jsonLinks)\n    };\n  };\n\n  //----------------------------------------------------------------------------\n  // render\n\n  const renderSections = function (modelSections, containerEl) {\n    modelSections.forEach(function (sectionModel) {\n      renderTemplate(containerEl, \"sectionTemplate\", sectionModel);\n    });\n  };\n\n  const render = function (model) {\n    renderSections(model.left, document.querySelector(\".designportal-left\"));\n    renderSections(model.right, document.querySelector(\".designportal-right\"));\n  };\n\n  const generateSrcFromFileKey = function (filekey) {\n    return new Promise(function (resolve) {\n      const apiurl = \"/k/v1/file.json?fileKey=\" + filekey;\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", apiurl, true);\n      xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n      xhr.responseType = \"blob\";\n      xhr.onload = function () {\n        const blob = new Blob([xhr.response]);\n        const url = window.URL || window.webkitURL;\n        const src = url.createObjectURL(blob);\n        resolve(src);\n      };\n      xhr.send();\n    });\n  }\n\n  const loadImage = function (iconEl, defaultIconUrl) {\n    const fileKey = iconEl.getAttribute(\"data-fileKey\");\n    if (!fileKey) {\n      iconEl.src = defaultIconUrl;\n      return;\n    }\n    return generateSrcFromFileKey(fileKey).then(function (src) {\n      iconEl.src = src;\n    });\n  };\n\n  const loadSectionImages = function() {\n    const iconEls = document.querySelectorAll(\".classic-list_section\");\n    Array.prototype.forEach.call(iconEls, function (iconEl) {\n      loadImage(iconEl, DEFAULT_SECTION_URL);\n    });\n  };\n\n  const loadLinkImages = function() {\n    const iconEls = document.querySelectorAll(\".classic-list_icon\");\n    Array.prototype.forEach.call(iconEls, function (iconEl) {\n      loadImage(iconEl, DEFAULT_LINK_URL);\n    });\n  };\n\n  loadScript(JS_RENDER_URL)\n    .then(assertConfig)\n    .then(fetchConfig)\n    .then(convertToModel)\n    .then(render)\n    .then(function() {\n      loadSectionImages();\n      loadLinkImages();\n    });\n\n})();\n","headerColor":"","toolbarColor":"","hiddenPortalHeader":false,"portalHeaderColor":"","customize_version":1}